<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyosk ê²°ì œ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='checkout.css') }}">
</head>
<body>
    <div class="kiosk-container">
        <div class="kiosk-content">
            <div class="checkout-screen">
                <header class="checkout-header">
                    <h1 class="title">ê²°ì œ</h1>
                </header>
                
                <main class="checkout-content">
                    <div class="order-summary">
                        <h2 class="section-title">ì£¼ë¬¸ ë‚´ì—­</h2>
                        <div class="order-items" id="order-items-container">
                            <!-- ì¥ë°”êµ¬ë‹ˆ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                        </div>
                        <div class="order-total">
                            <div class="total-row">
                                <span>ì´ ê¸ˆì•¡</span>
                                <span id="total-amount">0ì›</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="checkout-options">
                        <div class="option-section">
                            <h2 class="section-title">í¬ì¥ ì„ íƒ</h2>
                            <div class="option-buttons">
                                <button class="option-btn active" data-option="takeout">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M21 5H3C1.89543 5 1 5.89543 1 7V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V7C23 5.89543 22.1046 5 21 5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M16 3V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M8 3V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    í¬ì¥
                                </button>
                                <button class="option-btn" data-option="instore">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M18 8H19C20.0609 8 21.0783 8.42143 21.8284 9.17157C22.5786 9.92172 23 10.9391 23 12C23 13.0609 22.5786 14.0783 21.8284 14.8284C21.0783 15.5786 20.0609 16 19 16H18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M2 8H18V17C18 18.0609 17.5786 19.0783 16.8284 19.8284C16.0783 20.5786 15.0609 21 14 21H6C4.93913 21 3.92172 20.5786 3.17157 19.8284C2.42143 19.0783 2 18.0609 2 17V8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M6 1V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M10 1V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M14 1V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    ë§¤ì¥
                                </button>
                            </div>
                        </div>
                        
                        
                        <div class="option-section">
                            <h2 class="section-title">ê²°ì œ ë°©ë²•</h2>
                            <div class="payment-options">
                                <button class="payment-option-btn active" data-payment="card">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="2" y="5" width="20" height="14" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <line x1="2" y1="10" x2="22" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span>ì‹ ìš©ì¹´ë“œ</span>
                                </button>
                                <button class="payment-option-btn" data-payment="kakaopay">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 2C6.48 2 2 5.51 2 9.83C2 12.73 3.94 15.27 6.88 16.63V21.03L12 17.75L17.12 21.03V16.63C20.06 15.27 22 12.73 22 9.83C22 5.51 17.52 2 12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span>ì¹´ì¹´ì˜¤í˜ì´</span>
                                </button>
                                <button class="payment-option-btn" data-payment="naverpay">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <rect x="2" y="4" width="20" height="16" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M8 10V14L10.5 12L13 14V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <line x1="16" y1="10" x2="16" y2="14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    <span>ë„¤ì´ë²„í˜ì´</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
                
                <footer class="checkout-footer">
                    <button id="back-button" class="back-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        ì´ì „
                    </button>
                    <button id="pay-button" class="pay-btn">
                        ê²°ì œ<br>í•˜ê¸°
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 5L19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </footer>
            </div>
        </div>
    </div>
    
    <!-- ê²°ì œ ì§„í–‰ í™”ë©´ -->
    <div class="payment-process" id="payment-process">
        <div class="process-content">
            <div class="process-icon">
                <div class="loading-spinner"></div>
            </div>
            <h2 class="process-text">ê²°ì œê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤...</h2>
            <p class="process-instruction">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
        </div>
    </div>

    <!-- ê²°ì œ ì™„ë£Œ í™”ë©´ -->
    <div class="payment-complete" id="payment-complete">
        <div class="complete-content">
            <div class="complete-icon">âœ“</div>
            <h2 class="complete-text">ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h2>
            <p class="complete-instruction">ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤</p>
        </div>
    </div>
    
    <!-- í”¼ë“œë°± ëª¨ë‹¬ (í‰ê°€ í™”ë©´) -->
    <div class="feedback-modal" id="feedback-modal">
        <div class="modal-content">
            <h2 class="modal-title">ì£¼ë¬¸ ë§Œì¡±ë„ í‰ê°€</h2>
            <p class="modal-text">ì˜¤ëŠ˜ì˜ ì£¼ë¬¸ ê²½í—˜ì€ ì–´ë– ì…¨ë‚˜ìš”?</p>
            <div class="rating-buttons">
                <button class="rating-btn" data-rating="1">ğŸ˜</button>
                <button class="rating-btn" data-rating="2">ğŸ˜•</button>
                <button class="rating-btn" data-rating="3">ğŸ˜</button>
                <button class="rating-btn" data-rating="4">ğŸ™‚</button>
                <button class="rating-btn" data-rating="5">ğŸ˜Š</button>
            </div>
            <button id="close-modal-btn" class="modal-button" id="payment-complete-button">ì™„ë£Œ</button>
        </div>
    </div>
    
    <script>
        // ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° ë¡œë“œ
       // ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° ë¡œë“œ
        let cart = [];
        const orderItemsContainer = document.getElementById('order-items-container');
        const totalAmountElement = document.getElementById('total-amount');
        let selectedRating = 0;  // ì„ íƒëœ ë³„ì  ì €ì¥ ë³€ìˆ˜ ì¶”ê°€

        // ì£¼ë¬¸ í•­ëª© í‘œì‹œ
        function displayOrderItems() {
            orderItemsContainer.innerHTML = '';
            let totalAmount = 0;
            
            // ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆì§€ ì•Šì€ ê²½ìš°
            if (cart.length > 0) {
                cart.forEach(item => {
                    const orderItem = document.createElement('div');
                    orderItem.classList.add('order-item');
                    
                    // ìƒí’ˆì˜ ì´ ê°€ê²© ê³„ì‚°
                    const itemTotal = item.price * item.quantity;
                    totalAmount += itemTotal;
                    
                    orderItem.innerHTML = `
                        <div class="item-name">${item.name} <span class="item-quantity">x${item.quantity}</span></div>
                        <div class="item-price">${itemTotal.toLocaleString()}ì›</div>
                    `;
                    
                    orderItemsContainer.appendChild(orderItem);
                });
            } else {
                // ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆëŠ” ê²½ìš°
                const emptyCartMessage = document.createElement('div');
                emptyCartMessage.classList.add('empty-cart-message');
                emptyCartMessage.textContent = 'ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤';
                orderItemsContainer.appendChild(emptyCartMessage);
            }
            
            // ì´ì•¡ ì—…ë°ì´íŠ¸
            totalAmountElement.textContent = totalAmount.toLocaleString() + 'ì›';
        }

        // ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadCartData() {
            const savedCart = sessionStorage.getItem('cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                console.log('ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° ë¡œë“œë¨:', cart);
            } else {
                console.log('ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì¥ë°”êµ¬ë‹ˆ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ê²°ì œ ì²˜ë¦¬ í•¨ìˆ˜
        function processPayment() {
            // ì„ íƒëœ ê²°ì œ ë°©ë²• í™•ì¸
            const selectedPaymentMethod = document.querySelector('.payment-option-btn.active').getAttribute('data-payment');
            
            // ì„ íƒëœ í¬ì¥ ì˜µì…˜ í™•ì¸
            const selectedOption = document.querySelector('.option-btn.active').getAttribute('data-option');
            
            // ê²°ì œ ì²˜ë¦¬ ë¡œì§ (ì‹¤ì œë¡œëŠ” ì„œë²„ì™€ í†µì‹ )
            console.log('ê²°ì œ ë°©ë²•:', selectedPaymentMethod);
            console.log('í¬ì¥ ì˜µì…˜:', selectedOption);
            
            // ê²°ì œ ì§„í–‰ í™”ë©´ í‘œì‹œ
            document.getElementById('payment-process').style.display = 'flex';
            
            // 2ì´ˆ í›„ ê²°ì œ ì™„ë£Œ í™”ë©´ í‘œì‹œ
            setTimeout(() => {
                document.getElementById('payment-process').style.display = 'none';
                document.getElementById('payment-complete').style.display = 'flex';
                
                // 2ì´ˆ í›„ í”¼ë“œë°± ëª¨ë‹¬ í‘œì‹œ
                setTimeout(() => {
                    document.getElementById('payment-complete').style.display = 'none';
                    document.getElementById('feedback-modal').style.display = 'flex';
                }, 2000);
            }, 2000);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            // ì¥ë°”êµ¬ë‹ˆ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ì£¼ë¬¸ ë‚´ì—­ í‘œì‹œ
            loadCartData();
            displayOrderItems();
            
            // ë…¸ì¸ ì—¬ë¶€ ì •ë³´ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ìœ¼ë¡œ false ì„¤ì • (ì¼ë°˜ ë©”ë‰´ëŠ” ì¼ë°˜ ì‚¬ìš©ììš©ì´ë¯€ë¡œ)
            if (localStorage.getItem('isElderly') === null) {
                localStorage.setItem('isElderly', 'false');
            }
            
            // í¬ì¥ ì˜µì…˜ ì„ íƒ
            const optionButtons = document.querySelectorAll('.option-btn');
            optionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // í˜„ì¬ ê·¸ë£¹ì˜ ëª¨ë“  ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                    this.parentElement.querySelectorAll('.option-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // í´ë¦­ëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
                    this.classList.add('active');
                });
            });
            
            // ê²°ì œ ë°©ë²• ì„ íƒ
            const paymentButtons = document.querySelectorAll('.payment-option-btn');
            paymentButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // ëª¨ë“  ê²°ì œ ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                    paymentButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // í´ë¦­ëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
                    this.classList.add('active');
                });
            });
            
            // ê²°ì œí•˜ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ê²°ì œ ì²˜ë¦¬
            document.getElementById('pay-button').addEventListener('click', processPayment);
            
            // ì´ì „ ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ë‰´ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
            document.getElementById('back-button').addEventListener('click', function() {
                window.history.back();
            });
            
            // í”¼ë“œë°± ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ - íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™ ìˆ˜ì •
            document.getElementById('close-modal-btn').addEventListener('click', function() {
                document.getElementById('feedback-modal').style.display = 'none';
                
                // ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
                sessionStorage.removeItem('cart');
                
                // ë…¸ì¸ ì—¬ë¶€ ê°€ì ¸ì˜¤ê¸°
                const isElderly = localStorage.getItem('isElderly') === 'true';
                
                // íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™í•˜ë©° ë…¸ì¸ ì—¬ë¶€ ì „ë‹¬
                window.location.href = `/signup-check?is_elderly=${isElderly}`;
            });
            
            // ë³„ì  ì„ íƒ ë²„íŠ¼
            const ratingButtons = document.querySelectorAll('.rating-btn');
            ratingButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // ëª¨ë“  ë³„ì  ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                    ratingButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // í´ë¦­ëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
                    this.classList.add('active');
                    
                    // ì„ íƒëœ ë³„ì  ì €ì¥
                    selectedRating = this.getAttribute('data-rating');
                    console.log('ì„ íƒëœ ë³„ì :', selectedRating);
                });
            });
        });
    </script>
</body>
</html>