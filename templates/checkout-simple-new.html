<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°„í¸ ê²°ì œ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='checkout-simple.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='stamps.css') }}">
</head>
<body>
    <div class="checkout-container">
        <header class="checkout-header">
            <h1>ê²°ì œ í™”ë©´</h1>
        </header>

        <main class="checkout-content">
            <section class="order-summary">
                <h2>ì£¼ë¬¸ ë‚´ì—­</h2>
                <div class="order-items">
                    <!-- ì£¼ë¬¸ ì•„ì´í…œì´ JavaScriptë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                <div class="order-total">
                    <span class="total-label">ì´ ê¸ˆì•¡:</span>
                    <span class="total-amount">0ì›</span>
                </div>
            </section>

            <!-- ë§¤ì¥/í¬ì¥ ì„ íƒ ì„¹ì…˜ ì¶”ê°€ -->
            <section class="order-type-section">
                <h2>ë§¤ì¥ ë˜ëŠ” í¬ì¥</h2>
                <div class="order-type-buttons">
                    <button class="order-type-btn for-here" onclick="selectOrderType('for-here')">
                        <div class="icon">ğŸ½ï¸</div>
                        <span>ë§¤ì¥</span>
                    </button>
                    <button class="order-type-btn take-out" onclick="selectOrderType('take-out')">
                        <div class="icon">ğŸ“¦</div>
                        <span>í¬ì¥</span>
                    </button>
                </div>
            </section>

            

            <section class="payment-options">
                <h2>ê²°ì œ ë°©ë²• ì„ íƒ</h2>
                <div class="payment-buttons">
                    <button class="payment-btn card-btn" onclick="selectPayment('card')">
                        <div class="icon">ğŸ’³</div>
                        <span>ì¹´ë“œê²°ì œ</span>
                    </button>
                    <button class="payment-btn cash-btn" onclick="selectPayment('cash')">
                        <div class="icon">ğŸ’µ</div>
                        <span>í˜„ê¸ˆê²°ì œ</span>
                    </button>
                </div>
            </section>
        </main>

        <footer class="checkout-footer">
            <button class="back-btn" onclick="goBack()">ë’¤ë¡œ ê°€ê¸°</button>
        </footer>
    </div>

    <!-- ê²°ì œ ì§„í–‰ í™”ë©´ -->
    <div class="payment-process" id="payment-process">
        <div class="process-content">
            <div class="process-icon">
                <div class="loading-spinner"></div>
            </div>
            <h2 class="process-text">ê²°ì œê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤...</h2>
            <p class="process-instruction">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
        </div>
    </div>

    <!-- ê²°ì œ ì™„ë£Œ í™”ë©´ -->
    <div class="payment-complete" id="payment-complete">
        <div class="complete-content">
            <div class="complete-icon">âœ“</div>
            <h2 class="complete-text">ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h2>
            <p class="complete-instruction">ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤</p>
        </div>
    </div>

    <!-- ë³„ì  í™”ë©´ -->
    <div class="rating-container" id="rating-container">
        <div class="rating-content">
            <h2 class="rating-title">í™”ë©´ì€ ë³´ê¸° í¸í•˜ì…¨ë‚˜ìš”?</h2>
            <div class="stars-container">
                <div class="star" data-value="1" onclick="selectRating(1)">â˜…</div>
                <div class="star" data-value="2" onclick="selectRating(2)">â˜…</div>
                <div class="star" data-value="3" onclick="selectRating(3)">â˜…</div>
                <div class="star" data-value="4" onclick="selectRating(4)">â˜…</div>
                <div class="star" data-value="5" onclick="selectRating(5)">â˜…</div>
            </div>
            <button class="submit-rating" id="payment-complete-button" onclick="submitRating()">í‰ê°€ ì™„ë£Œ</button>
        </div>
    </div>

    <!-- í˜„ê¸ˆ ê²°ì œ ì•ˆë‚´ ëª¨ë‹¬ -->
    <div class="cash-payment-modal" id="cash-payment-modal">
        <div class="modal-content">
            <div class="modal-icon">ğŸ’µ</div>
            <h2 class="modal-title">í˜„ê¸ˆ ê²°ì œ ì•ˆë‚´</h2>
            <p class="modal-text">í˜„ê¸ˆ ê²°ì œëŠ” ì¹´ìš´í„°ì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤.<br>ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ê°€ì§€ê³  ì¹´ìš´í„°ë¡œ ì™€ì£¼ì„¸ìš”.</p>
            <div class="order-number">
                <h3>ì£¼ë¬¸ë²ˆí˜¸</h3>
                <div class="number">127</div>
            </div>
            <button class="modal-button" onclick="completeCashPayment()">í™•ì¸</button>
        </div>
    </div>

    <script>
        let cart = [];
        let selectedPaymentMethod = '';
        let selectedOrderType = '';
        let selectedRating = 0;
        let usePoints = true;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            loadCartData();
            displayOrderItems();
            updatePointsPreview();
            displayStamps(); // ìŠ¤íƒ¬í”„ í‘œì‹œ í•¨ìˆ˜ í˜¸ì¶œ
            
            // í¬ì¸íŠ¸ ì ë¦½ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            document.getElementById('points-checkbox').addEventListener('change', function() {
                usePoints = this.checked;
                updatePointsPreview();
            });
            
            // ë…¸ì¸ ì—¬ë¶€ ì •ë³´ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ìœ¼ë¡œ true ì„¤ì • (ê°„í¸ ë©”ë‰´ëŠ” ë…¸ì¸ìš©ì´ë¯€ë¡œ)
            if (localStorage.getItem('isElderly') === null) {
                localStorage.setItem('isElderly', 'true');
            }
        });
        
        // ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadCartData() {
            const savedCart = sessionStorage.getItem('cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
        }
        
        // ì£¼ë¬¸ ì•„ì´í…œ í‘œì‹œ
        function displayOrderItems() {
            const orderItemsContainer = document.querySelector('.order-items');
            const totalAmountElement = document.querySelector('.total-amount');
            
            // ì£¼ë¬¸ ì•„ì´í…œ ì´ˆê¸°í™”
            orderItemsContainer.innerHTML = '';
            
            // ì´ ê¸ˆì•¡ ê³„ì‚°
            let totalAmount = 0;
            
            // ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆì§€ ì•Šì€ ê²½ìš°
            if (cart.length > 0) {
                cart.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'order-item';
                    
                    itemElement.innerHTML = `
                        <div class="item-name">${item.name}</div>
                        <div class="item-quantity">${item.quantity}ê°œ</div>
                        <div class="item-price">${(item.price * item.quantity).toLocaleString()}ì›</div>
                    `;
                    
                    orderItemsContainer.appendChild(itemElement);
                    
                    // ì´ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
                    totalAmount += item.price * item.quantity;
                });
            } else {
                // ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆëŠ” ê²½ìš°
                const emptyCartElement = document.createElement('div');
                emptyCartElement.className = 'empty-cart';
                emptyCartElement.textContent = 'ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤';
                orderItemsContainer.appendChild(emptyCartElement);
            }
            
            // ì´ ê¸ˆì•¡ í‘œì‹œ
            totalAmountElement.textContent = totalAmount.toLocaleString() + 'ì›';
            
            // í¬ì¸íŠ¸ ì ë¦½ ì˜ˆì • ì—…ë°ì´íŠ¸
            updatePointsPreview();
        }
        
        // ìŠ¤íƒ¬í”„ í‘œì‹œ í•¨ìˆ˜
        function displayStamps() {
            // ì›ë˜ ê¸°ëŠ¥ ìœ ì§€
        }
        
        // ë§¤ì¥/í¬ì¥ ì„ íƒ
        function selectOrderType(type) {
            selectedOrderType = type;
            
            // ì„ íƒëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
            document.querySelectorAll('.order-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (type === 'for-here') {
                document.querySelector('.for-here').classList.add('active');
            } else {
                document.querySelector('.take-out').classList.add('active');
            }
        }
        
        // í¬ì¸íŠ¸ ì ë¦½ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePointsPreview() {
            // ì›ë˜ ê¸°ëŠ¥ ìœ ì§€
        }
        
        // ê²°ì œ ë°©ë²• ì„ íƒ
        function selectPayment(method) {
            // ë§¤ì¥/í¬ì¥ ì„ íƒ í™•ì¸
            if (!selectedOrderType) {
                alert('ë§¤ì¥ ë˜ëŠ” í¬ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            
            selectedPaymentMethod = method;
            
            if (method === 'cash') {
                // í˜„ê¸ˆ ê²°ì œ ì„ íƒ ì‹œ ì•ˆë‚´ ëª¨ë‹¬ í‘œì‹œ
                document.getElementById('cash-payment-modal').style.display = 'flex';
            } else {
                // ì¹´ë“œ ê²°ì œ ì„ íƒ ì‹œ ê²°ì œ ì§„í–‰ í™”ë©´ í‘œì‹œ
                document.getElementById('payment-process').style.display = 'flex';
                
                // 3ì´ˆ í›„ ê²°ì œ ì™„ë£Œ í™”ë©´ í‘œì‹œ
                setTimeout(function() {
                    document.getElementById('payment-process').style.display = 'none';
                    document.getElementById('payment-complete').style.display = 'flex';
                    
                    // 2ì´ˆ í›„ ë³„ì  í™”ë©´ í‘œì‹œ
                    setTimeout(function() {
                        document.getElementById('payment-complete').style.display = 'none';
                        document.getElementById('rating-container').style.display = 'flex';
                    }, 2000);
                }, 3000);
            }
        }
        
        // í˜„ê¸ˆ ê²°ì œ í™•ì¸ ë²„íŠ¼ í´ë¦­
        function completeCashPayment() {
            document.getElementById('cash-payment-modal').style.display = 'none';
            
            // ë³„ì  í™”ë©´ í‘œì‹œ
            document.getElementById('rating-container').style.display = 'flex';
        }
        
        // ë³„ì  ì„ íƒ
        function selectRating(rating) {
            selectedRating = rating;
            
            // ëª¨ë“  ë³„ì  ì´ˆê¸°í™”
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('selected');
            });
            
            // ì„ íƒí•œ ë³„ì ê¹Œì§€ ê°•ì¡° í‘œì‹œ
            for (let i = 1; i <= rating; i++) {
                document.querySelector(`.star[data-value="${i}"]`).classList.add('selected');
            }
        }
        
        // ë³„ì  ì œì¶œ
        function submitRating() {
            // ë³„ì  ë°ì´í„° ì €ì¥ (í•„ìš”í•œ ê²½ìš° ì„œë²„ë¡œ ì „ì†¡)
            if (selectedRating > 0) {
                console.log(`ì„ íƒí•œ ë³„ì : ${selectedRating}`);
                console.log(`ì„ íƒí•œ ì£¼ë¬¸ íƒ€ì…: ${selectedOrderType}`);
                
                // ë…¸ì¸ ì—¬ë¶€ ê°€ì ¸ì˜¤ê¸°
                const isElderly = localStorage.getItem('isElderly') === 'true';
                
                // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”
                sessionStorage.removeItem('cart');
                
                // íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™í•˜ë©° ë…¸ì¸ ì—¬ë¶€ ì „ë‹¬
                window.location.href = `/signup-check?is_elderly=${isElderly}`;
            } else {
                alert('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
            }
        }
        
        // ë’¤ë¡œ ê°€ê¸°
        function goBack() {
            window.location.href = "{{ url_for('menu_simple_new') }}";
        }
    </script>
</body>
</html>